<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Atelier PPNC - Production lignes</title>
  <link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#005bff" />

<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="style.css" />

  <!-- Chart.js pour les graphiques -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- SheetJS pour l'export Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("service-worker.js")
        .catch((err) => console.error("SW registration failed", err));
    });
  }
  </script>
</head>
<body>
  <header class="app-header">
    <div class="app-title">
      <span class="app-main-title">Atelier PPNC</span>
      <span class="app-sub-title">Suivi Production & Arr√™ts</span>
    </div>
    <div class="header-info" id="header-datetime">
      <!-- Date / heure / semaine / √©quipe inject√©s par JS -->
    </div>
  </header>

  <!-- Barre de navigation principale -->
  <nav class="top-nav">
    <button class="nav-btn active" data-section="atelier">Atelier</button>
    <button class="nav-btn" data-section="production">Production</button>
    <button class="nav-btn" data-section="arrets">Arr√™ts</button>
    <button class="nav-btn" data-section="organisation">Organisation</button>
    <button class="nav-btn" data-section="personnel">Personnel</button>
    <button class="nav-btn" data-section="validation">Validation DDM</button>
  </nav>

  <main>
    <!-- PAGE ATELIER (accueil / vue d‚Äôensemble) -->
    <section id="section-atelier" class="section visible">
      <h2>Vue d‚Äôensemble Atelier</h2>

      <div class="atelier-grid">
        <div class="card">
          <h3>Production par ligne (aujourd‚Äôhui)</h3>
          <div id="atelier-lines-summary">
            <!-- R√©sum√© par ligne g√©n√©r√© en JS -->
          </div>
        </div>

        <div class="card">
          <h3>√âvolution des cadences</h3>
          <canvas id="atelierChart"></canvas>
          <p class="helper-text">
            Une courbe par ligne, bas√©e sur les enregistrements de production.
          </p>
        </div>

        <div class="card">
          <h3>Arr√™ts principaux</h3>
          <table class="table" id="atelier-arrets-table">
            <thead>
              <tr>
                <th>Ligne</th>
                <th>Type</th>
                <th>Dur√©e (min)</th>
                <th>Commentaire</th>
              </tr>
            </thead>
            <tbody>
              <!-- Arr√™ts tri√©s par dur√©e (desc) -->
            </tbody>
          </table>
        </div>

        <div class="card">
          <h3>Export Excel global</h3>
          <p class="helper-text">
            Exporte Production, Arr√™ts, Organisation, Personnel sur plusieurs onglets dans un seul fichier Excel.
          </p>
          <button id="exportGlobalBtn" class="primary-btn">üì§ Export global Excel</button>
        </div>
      </div>
    </section>

    <!-- PAGE PRODUCTION -->
    <section id="section-production" class="section">
      <div class="production-layout">
        <aside class="lines-sidebar">
          <h3>Lignes</h3>
          <div class="lines-list" id="linesList">
            <!-- Boutons de lignes g√©n√©r√©s par JS -->
          </div>
        </aside>

        <div class="line-content">
          <h2 id="currentLineTitle">Ligne</h2>

          <div class="card">
            <h3>Saisie production</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="prodStartTime">Heure d√©but</label>
                <input type="time" id="prodStartTime" />
              </div>
              <div class="form-group">
                <label for="prodEndTime">Heure fin</label>
                <input type="time" id="prodEndTime" />
              </div>
              <div class="form-group">
                <label for="prodQuantity">Quantit√© produite (colis)</label>
                <input type="number" id="prodQuantity" min="0" />
              </div>
              <div class="form-group">
                <label for="prodRemaining">Quantit√© restante (colis)</label>
                <input type="number" id="prodRemaining" min="0" />
              </div>
              <div class="form-group">
                <label for="prodCadenceManual">Cadence manuelle (colis/heure)</label>
                <input type="number" id="prodCadenceManual" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="prodArretMinutes">Arr√™ts (min)</label>
                <input type="number" id="prodArretMinutes" min="0" />
              </div>
              <div class="form-group form-group-wide">
                <label for="prodComment">Commentaire</label>
                <textarea id="prodComment" rows="2"></textarea>
              </div>
            </div>

            <div class="info-row">
              <div>
                <strong>Cadence calcul√©e :</strong>
                <span id="prodCadenceDisplay">-</span> colis/heure
              </div>
              <div>
                <strong>Temps restant estim√© :</strong>
                <span id="prodRemainingTimeDisplay">-</span>
              </div>
            </div>

            <div class="buttons-row">
              <button id="prodSaveBtn" class="primary-btn">üíæ Enregistrer</button>
              <button id="prodUndoBtn" class="secondary-btn">‚Ü©Ô∏è Annuler dernier</button>
            </div>
          </div>

          <div class="card">
            <h3>Historique de la ligne</h3>
            <table class="table" id="prodHistoryTable">
              <thead>
                <tr>
                  <th>Date/Heure</th>
                  <th>√âquipe</th>
                  <th>D√©but</th>
                  <th>Fin</th>
                  <th>Qt√©</th>
                  <th>Arr√™t (min)</th>
                  <th>Cadence</th>
                  <th>Temps restant estim√©</th>
                  <th>Commentaire</th>
                  <th>Suppr.</th>
                </tr>
              </thead>
              <tbody>
                <!-- Historique ligne courante -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- PAGE ARRETS -->
    <section id="section-arrets" class="section">
  <div class="page-header">
    <h1>Suivi des arr√™ts</h1>
  </div>

  <!-- Carte de saisie d'un arr√™t -->
  <div class="card">
    <h2>Nouvel arr√™t</h2>

    <!-- Ligne concern√©e -->
    <div class="form-row">
      <label for="arretLine">Ligne impact√©e :</label>
      <select id="arretLine">
        <!-- Rempli automatiquement par app.js avec la constante LINES -->
      </select>
    </div>

    <!-- Sous-zone (D√©coupe / Packing / MEC / Autre) -->
    <div class="form-row">
      <label for="arretSousZone">Sous-zone :</label>
      <select id="arretSousZone">
        <!-- Options remplies par app.js en fonction de la ligne -->
      </select>
    </div>

    <!-- Machine (liste d√©taill√©e issue du document Word) -->
    <div class="form-row">
      <label for="arretMachine">Machine / origine de l'arr√™t :</label>
      <select id="arretMachine">
        <!-- Options remplies par app.js en fonction de la ligne + sous-zone -->
      </select>
    </div>

    <!-- Dur√©e d'arr√™t -->
    <div class="form-row">
      <label for="arretDuration">Dur√©e de l'arr√™t (minutes) :</label>
      <input
        type="number"
        id="arretDuration"
        min="0"
        step="1"
        placeholder="0"
      />
    </div>

    <!-- Commentaire -->
    <div class="form-row">
      <label for="arretComment">Commentaire :</label>
      <textarea
        id="arretComment"
        rows="3"
        placeholder="D√©tails / explications..."
      ></textarea>
    </div>

    <!-- Bouton d'enregistrement -->
    <div class="form-actions">
      <button id="arretSaveBtn" class="primary-btn">
        üíæ Enregistrer l'arr√™t
      </button>
    </div>
  </div>

  <!-- Carte historique des arr√™ts -->
  <div class="card">
    <h2>Historique des arr√™ts</h2>
    <div class="table-wrapper">
      <table id="arretsHistoryTable" class="data-table">
        <thead>
          <tr>
            <th>Date / Heure</th>
            <th>Ligne</th>
            <th>Sous-zone</th>
            <th>Machine</th>
            <th>Dur√©e (min)</th>
            <th>Commentaire</th>
          </tr>
        </thead>
        <tbody>
          <!-- Rempli par app.js -->
        </tbody>
      </table>
    </div>
  </div>
    </section>

    <!-- PAGE ORGANISATION (consignes) -->
    <section id="section-organisation" class="section">
      <h2>Organisation / Consignes</h2>
      <div class="card">
        <h3>Nouvelle consigne</h3>
        <div class="form-grid">
          <div class="form-group form-group-wide">
            <label for="orgConsigne">Consigne</label>
            <textarea id="orgConsigne" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="orgVisa">Visa</label>
            <input type="text" id="orgVisa" />
          </div>
        </div>
        <div class="buttons-row">
          <button id="orgSaveBtn" class="primary-btn">üíæ Enregistrer consigne</button>
        </div>
      </div>

      <div class="card">
        <h3>Historique des consignes</h3>
        <table class="table" id="orgHistoryTable">
          <thead>
            <tr>
              <th>Date/Heure</th>
              <th>√âquipe</th>
              <th>Consigne</th>
              <th>Visa</th>
              <th>Valid√©e ?</th>
            </tr>
          </thead>
          <tbody>
            <!-- Historique consignes -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- PAGE PERSONNEL -->
    <section id="section-personnel" class="section">
      <h2>Personnel</h2>
      <div class="card">
        <h3>√âv√©nement personnel</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="persNom">Nom</label>
            <input type="text" id="persNom" />
          </div>
          <div class="form-group">
            <label for="persMotif">Motif</label>
            <select id="persMotif">
              <option value="Absence">Absence</option>
              <option value="Retard">Retard</option>
              <option value="D√©part">D√©part</option>
              <option value="Autre">Autre</option>
            </select>
          </div>
          <div class="form-group form-group-wide">
            <label for="persComment">Commentaire</label>
            <textarea id="persComment" rows="2"></textarea>
          </div>
        </div>
        <div class="buttons-row">
          <button id="persSaveBtn" class="primary-btn">üíæ Enregistrer</button>
        </div>
      </div>

      <div class="card">
        <h3>Historique personnel</h3>
        <table class="table" id="persHistoryTable">
          <thead>
            <tr>
              <th>Date/Heure</th>
              <th>√âquipe</th>
              <th>Nom</th>
              <th>Motif</th>
              <th>Commentaire</th>
            </tr>
          </thead>
          <tbody>
            <!-- Historique personnel -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- PAGE VALIDATION DDM -->
    <section id="section-validation" class="section">
      <h2>Validation DDM</h2>
      <div class="card">
        <h3>Calcul de la DDM</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="ddmQuantieme">Quanti√®me fabrication (1-366)</label>
            <input type="number" id="ddmQuantieme" min="1" max="366" />
          </div>
          <div class="form-group">
            <label for="ddmAnnee">Ann√©e fabrication</label>
            <input type="number" id="ddmAnnee" />
          </div>
          <div class="form-group">
            <label for="ddmDuree">Dur√©e de vie (jours)</label>
            <input type="number" id="ddmDuree" min="0" />
          </div>
        </div>
        <div class="buttons-row">
          <button id="ddmCalcBtn" class="primary-btn">üßÆ Calculer DDM</button>
        </div>
        <p class="ddm-result">
          DDM calcul√©e : <strong id="ddmResult">-</strong>
        </p>
      </div>
    </section>
  </main>

  <!-- CALCULATRICE FLOTTANTE -->
  <div id="calculator" class="calculator hidden">
    <div class="calc-header">
      <span>Calculatrice</span>
      <button id="calcCloseBtn" class="calc-close-btn">‚úï</button>
    </div>
    <input type="text" id="calcDisplay" class="calc-display" readonly />
    <div class="calc-grid">
      <button class="calc-btn" data-value="7">7</button>
      <button class="calc-btn" data-value="8">8</button>
      <button class="calc-btn" data-value="9">9</button>
      <button class="calc-btn op" data-value="/">√∑</button>

      <button class="calc-btn" data-value="4">4</button>
      <button class="calc-btn" data-value="5">5</button>
      <button class="calc-btn" data-value="6">6</button>
      <button class="calc-btn op" data-value="*">√ó</button>

      <button class="calc-btn" data-value="1">1</button>
      <button class="calc-btn" data-value="2">2</button>
      <button class="calc-btn" data-value="3">3</button>
      <button class="calc-btn op" data-value="-">‚àí</button>

      <button class="calc-btn" data-value="0">0</button>
      <button class="calc-btn" data-value=".">.</button>
      <button class="calc-btn" data-action="clear">C</button>
      <button class="calc-btn op" data-value="+">+</button>

      <button class="calc-btn equals" data-action="equals">=</button>
    </div>
  </div>
  <button id="calcToggle" class="calculator-toggle">üßÆ</button>

  <script src="app.js"></script>
</body>
</html>
